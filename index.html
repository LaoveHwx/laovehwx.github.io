<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>给我的最爱 hwx</title>

    <!-- 字体图标 & Supabase -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <style>
        /* ===== 公共样式 ===== */
        *{margin:0;padding:0;box-sizing:border-box}
        body{
            font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;
            color:#8a2b53;
            min-height:100vh;
            background-image:url('我们.jpg');
            background-position:5% center;
            background-size:cover;
            background-repeat:no-repeat;
            background-attachment:fixed;
            background-color:rgba(255,235,238,.9);
            display:flex;
            justify-content:center;
            align-items:flex-start;
            padding:20px;
            overflow-x: hidden;
        }
        #hearts{position:fixed;width:100%;height:100%;top:0;left:0;z-index:0;pointer-events:none}
        .heart{position:absolute;font-size:20px;color:#ff4d6d;opacity:.7;animation:fall linear forwards;pointer-events: none;z-index: 0;}
        @keyframes fall{to{transform:translateY(100vh) rotate(30deg);}}

        /* ===== 左侧导航 ===== */
        .sidebar{
            position:fixed;left:0;top:0;height:100vh;width:250px;
            background:linear-gradient(to bottom,#ff9a9e,#fad0c4);
            padding:20px 0;z-index:10;box-shadow:2px 0 10px rgba(0,0,0,.1);
            transition:all .3s ease;
        }
        .logo{color:#fff;text-align:center;font-size:1.5rem;font-weight:bold;margin-bottom:30px;text-shadow:1px 1px 3px rgba(0,0,0,.2)}
        .nav-links{list-style:none;padding:0}
        .nav-item{display:flex;align-items:center;padding:15px 25px;margin:5px 0;color:#fff;cursor:pointer;transition:.3s;border-left:4px solid transparent}
        .nav-item:hover{background:rgba(255,255,255,.1)}
        .nav-item.active{background:rgba(255,255,255,.2);border-left:4px solid #fff}
        .nav-item i{margin-right:15px;font-size:1.2rem}

        /* ===== 页面内容 ===== */
        .page-content{margin-left:250px;width:calc(100% - 250px);min-height:100vh;transition:all .3s ease}
        .page{display:none;padding:20px}
        .page.active{display:block}

        /* ===== 首页内容 ===== */
        .content{
            position:relative;z-index:1;display:flex;flex-direction:column;justify-content:center;
            align-items:center;text-align:center;padding:30px;
            background:rgba(255,255,255,.12);border-radius:20px;max-width:90%;width:600px;margin:40px 0;
            box-shadow:0 10px 30px rgba(0,0,0,.15);backdrop-filter:blur(5px);border:1px solid rgba(255,255,255,.25)
        }
        h1{font-size:2.5rem;margin-bottom:20px;color:#d81b60;text-shadow:2px 2px 4px rgba(0,0,0,.1)}
        .message{width:100%;padding:25px;border-radius:15px;margin-bottom:30px;
            line-height:1.6;font-size:1.1rem;background:rgba(255,255,255,.5);text-align:left}
        .message p{margin-bottom:15px}

        /* ===== 计时器 ===== */
        .love-timer{text-align:center;margin-bottom:30px;padding:20px;background:rgba(255,255,255,.9);
            border-radius:15px;box-shadow:0 5px 20px rgba(216,27,96,.2);border:2px solid #ff80ab;width:100%}
        .timer-title{font-size:1.2rem;color:#d81b60;margin-bottom:10px;font-weight:bold}
        .timer-display{font-size:1.5rem;font-weight:bold;color:#e91e63;margin:10px 0;
            display:flex;justify-content:center;flex-wrap:wrap;gap:5px}
        .timer-display span{background:linear-gradient(45deg,#f48fb1,#f06292);padding:5px 10px;border-radius:8px;
            color:white;min-width:40px;display:inline-block;text-align:center;box-shadow:0 2px 5px rgba(0,0,0,.1)}
        .timer-start{font-size:.9rem;color:#888;font-style:italic;margin-top:10px}

        /* ===== 音乐播放器 ===== */
        .music-player{width:100%;margin-top:20px;background:linear-gradient(to right,rgba(233,30,99,.35),rgba(255,64,129,.35));
            padding:15px 20px;border-radius:50px;display:flex;align-items:center;justify-content:space-between;
            color:white;box-shadow:0 4px 15px rgba(233,30,99,.3);backdrop-filter:blur(5px);border:1px solid rgba(255,255,255,.2)}
        .play-btn{background:none;border:none;color:white;font-size:1.5rem;cursor:pointer;margin-right:15px;
            width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;transition:.3s}
        .play-btn:hover{background:rgba(255,255,255,.2)}
        .progress-container{flex-grow:1;margin:0 15px;height:4px;background:rgba(255,255,255,.3);border-radius:2px;cursor:pointer;position:relative}
        .progress{height:100%;background:white;border-radius:2px;width:0}
        .time{font-size:.8rem;min-width:40px}

        /* ===== 烟花按钮 ===== */
        #fireworksBtn{position:fixed;bottom:20px;right:20px;z-index:100;
            background:linear-gradient(135deg,#6e8efb,#a777e3,#ffd700,#ff8c00);
            color:white;border:none;padding:12px 20px;border-radius:30px;
            cursor:pointer;font-weight:bold;box-shadow:0 4px 15px rgba(0,0,0,.2);transition:.3s}
        #fireworksBtn:hover{transform:translateY(-3px);box-shadow:0 7px 20px rgba(0,0,0,.3)}

        /* ===== 烟花 & 文字 ===== */
        #fireworks-container{position:fixed;top:0;left:0;width:100%;height:100%;
            pointer-events:none;z-index:99;display:none;overflow:hidden}
        #qixi-text{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%) scale(0);
            font-weight:bold;color:transparent;background:linear-gradient(45deg,#6e8efb,#a777e3,#ffd700,#ff8c00);
            -webkit-background-clip:text;background-clip:text;z-index:100;opacity:0;
            pointer-events:none;text-shadow:0 0 10px rgba(255,255,255,.5);
            transition:all 2s ease;white-space:nowrap;font-size:4rem;text-align:center;width:100%;padding:0 20px}

        /* ===== 开心收集站和坏情绪垃圾桶 ===== */
        .entries-container {
            max-width:800px;margin:0 auto;padding:20px;
            background:rgba(255,255,255,.9);border-radius:20px;
            box-shadow:0 10px 30px rgba(0,0,0,.1)
        }
        .entries-container h2 {color:#d81b60;margin-bottom:15px;}
        .entries-container p {margin-bottom:20px;color:#666;}
        .entry-textarea {
            width:100%;height:120px;padding:15px;
            border:2px solid #ffd166;border-radius:15px;
            resize:none;margin-bottom:15px;font-family:inherit;
        }
        .save-btn {
            background:linear-gradient(to right,#ff9a9e,#fad0c4);
            color:#fff;border:none;padding:12px 25px;
            border-radius:30px;cursor:pointer;font-weight:bold;
        }
        .trash-textarea {border-color:#b0b0b0;}
        .trash-btn {background:#616161;}
        .entries-list {max-height:400px;overflow-y:auto;margin-top:20px;}
        .entry-item {
            background:rgba(255,255,255,.7);border-radius:10px;
            padding:15px;margin-bottom:15px;border-left:4px solid #ff9a9e;
        }
        .trash-item {border-left-color:#9e9e9e;}
        .entry-date {font-size:.8rem;color:#888;margin-bottom:8px;}
        .entry-meta {font-size:.7rem;color:#aaa;margin-top:4px;}

        /* ===== 响应式 ===== */
        @media (max-width:1100px){
            .content{width:90%;max-width:90%;padding:20px}
            .message{padding:15px;font-size:1rem}
            h1{font-size:2rem}
        }
        @media(max-width:900px){
            .sidebar{width:70px}
            .page-content{margin-left:70px;width:calc(100% - 70px)}
            .nav-item span{display:none}
            .logo{font-size:1rem}
        }
        @media(max-width:768px){
            h1{font-size:1.8rem}
            #qixi-text{font-size:3rem}
            .timer-display{font-size:1.2rem}
            .timer-display span{min-width:30px;padding:3px 8px}
            .music-player{flex-wrap:wrap;padding:10px 15px}
            .progress-container{order:3;width:100%;margin:10px 0 0 0}
        }
        @media(max-width:600px){
            body{padding:10px}
            .sidebar{width:100%;height:60px;bottom:0;top:auto;display:flex;justify-content:space-around;padding:0;
                background:linear-gradient(to right,#ff9a9e,#fad0c4)}
            .logo{display:none}
            .nav-links{display:flex;width:100%;justify-content:space-around}
            .nav-item{flex-direction:column;padding:10px 5px;margin:0;border-left:none;border-top:4px solid transparent;font-size:.8rem}
            .nav-item.active{border-left:none;border-top:4px solid #fff}
            .nav-item i{margin-right:0;margin-bottom:5px;font-size:1rem}
            .page-content{margin-left:0;width:100%;padding-bottom:70px}
            #qixi-text{font-size:2.5rem}
            .content{margin:20px 0;padding:15px}
            .love-timer{padding:15px}
            .message{padding:10px;font-size:.95rem}
            #fireworksBtn{bottom:70px;right:10px;padding:10px 15px;font-size:.9rem}
        }
        @media(max-width:400px){
            h1{font-size:1.6rem}
            .timer-display{font-size:1rem;gap:3px}
            .timer-display span{min-width:25px;padding:2px 5px}
            #qixi-text{font-size:2rem}
        }
    </style>
</head>
<body>
    <!-- 爱心背景 -->
    <div id="hearts"></div>

    <!-- 左侧导航栏 -->
    <nav class="sidebar">
        <div class="logo">爱的小屋</div>
        <ul class="nav-links">
            <li class="nav-item active" data-page="home">
                <i class="fas fa-home"></i><span>首页</span>
            </li>
            <li class="nav-item" data-page="happy">
                <i class="fas fa-smile"></i><span>开心收集站</span>
            </li>
            <li class="nav-item" data-page="trash">
                <i class="fas fa-trash-alt"></i><span>坏情绪垃圾桶</span>
            </li>
        </ul>
    </nav>

    <!-- 页面内容区域 -->
    <div class="page-content">
        <!-- 首页 -->
        <div id="home-page" class="page active">
            <div class="content">
                <!-- 爱情计时器 -->
                <div class="love-timer">
                    <div class="timer-title">我们相爱已经</div>
                    <div class="timer-display" id="loveTimer">
                        <span id="years">0</span>年
                        <span id="months">0</span>月
                        <span id="days">0</span>天
                        <span id="hours">0</span>时
                        <span id="minutes">0</span>分
                        <span id="seconds">0</span>秒
                    </div>
                    <div class="timer-start">直到也依然爱你！</div>
                </div>

                <!-- 音乐播放器 -->
                <div class="music-player">
                    <div class="player-controls">
                        <button class="play-btn" id="playBtn"><i class="fas fa-play"></i></button>
                        <div class="song-info"><div class="song-title">我们</div><div class="artist">致我们</div></div>
                    </div>
                    <div class="progress-container" id="progressContainer"><div class="progress" id="progress"></div></div>
                    <div class="time" id="currentTime">0:00</div>
                    <div class="volume-container">
                        <button class="volume-btn" id="volumeBtn"><i class="fas fa-volume-up"></i></button>
                        <input type="range" class="volume-slider" id="volumeSlider" min="0" max="1" step="0.01" value="0.7">
                    </div>
                </div>

                <!-- 标题 -->
                <h1>给我最亲爱的人</h1>

                <!-- 信件 -->
                <div class="message">
                    <p>亲爱的胡婉欣，很开心遇见你，还跟你做了情侣，觉得自己超级幸运的！！！</p>
                    <p>给你做的这个小网站只要联网随时可以进来，给你一个不一样的情人节</p>
                    <p>首先，我要表达对你的感觉，它就像是看见一只很喜欢的小猫，干什么事情都很可爱，不开心了也会觉得"她只是一只小咪而已啦"。想给你吃好吃的，看不得你不开心看不得你不舒服，很想照顾你这只小猫。小咪还小，很多事情都不会，所以我会好好爱你。</p>
                    <p>有时候就是我爱的一个人，一个完完整整的你。好的坏的，那些都是组成你的部分，只要是你，我都愿意接近你，抱住你。</p>
                    <p>最近我才学会，我这种说的做的知行不合一对你来说非常地无语，所以借此机会，我想跟你说，我明白了爱是你在专注做事情的时候递上的一杯温水，是你累的时候，一个不再多嘴的安静的拥抱，是你想一个人待会儿的时候，我爽快说"好"的瞬间</p>
                    <p>这是我正在学习，并且会一直学习的自我成长课题——学会爱，正确的爱，让你和我待在可以轻轻松松的，开心快乐的，无拘无束的</p>
                    <p>爱应该是，你自由的，我旁观的，需要的时候可以帮助你的，彼此都是独立的。不给你太多压力。其实有时候我应该知道，你也还是小咪，一个人长这么大，也没人教你怎么爱，我不能要求你太多了。你给我的已经是你能给的最好的了，我珍惜，我庆幸，我幸福，非常谢谢你爱我！！</p>
                    <p>人嘛，爱一个人肯定会对她有所期待，所以爱你的心路也很曲折，内耗又自愈，想开了又纠结的，我告诉自己坚持，因为真的特别爱你，需要义无反顾，要勇敢。但是没关系，好在你也在接近我，愿意爱我，愿意为我调整和改变。我知道你已经做到你能做的最好，所以我要珍惜。</p>
                    <p>之前我们不开心那些，回想起来很是很心疼，请你相信我会用后面的日子让你重新认识我这个又新也旧的黎安锐。</p>
                    <p>直到今天，我还是很爱你，仅仅告知你的那种我爱你。黎安锐陪你成长，陪你度过漫长岁月，我希望我们时间可以长一些，再长一些，再长一抹多……</p>
                    <p>至此，祝我们第三次七夕快乐，我的梦寐以求的爱人，珍惜若宝的，胡婉欣。</p>
                    <p>——爱你的黎安锐</p>
                </div>

                <div class="footer"><p>永远爱你的黎安锐 ❤️</p></div>
            </div>
        </div>

        <!-- 开心收集站 -->
        <div id="happy-page" class="page">
            <div class="entries-container">
                <h2>开心收集站</h2>
                <p>记录生活中的每一个快乐瞬间</p>
                <div class="happy-input">
                    <textarea id="happy-text" class="entry-textarea" placeholder="今天有什么开心的事呀？"></textarea>
                    <button id="save-happy" class="save-btn">保存开心</button>
                </div>
                <div id="happy-entries" class="entries-list"></div>
            </div>
        </div>

        <!-- 坏情绪垃圾桶 -->
        <div id="trash-page" class="page">
            <div class="entries-container">
                <h2>坏情绪垃圾桶</h2>
                <p>把不开心的事情都丢进来吧</p>
                <div class="trash-input">
                    <textarea id="unhappy-text" class="entry-textarea trash-textarea" placeholder="有什么不开心的事，说出来会好受些"></textarea>
                    <button id="save-trash" class="save-btn trash-btn">丢弃情绪</button>
                </div>
                <div id="unhappy-entries" class="entries-list"></div>
            </div>
        </div>
    </div>

    <!-- 音频 -->
    <audio id="music"><source src="我们.mp3" type="audio/mpeg">您的浏览器不支持音频元素。</audio>

    <!-- 烟花按钮 & 容器 -->
    <button id="fireworksBtn"><i class="fas fa-fire"></i> 点燃爱的烟花</button>
    <div id="fireworks-container"></div>
    <div id="qixi-text">七夕快乐</div>

    <script>
        /* ========== 爱心背景 ========== */
        function createHeart() {
            const heart = document.createElement('div');
            heart.innerHTML = '❤️';
            heart.classList.add('heart');
            heart.style.left = Math.random() * 100 + 'vw';
            heart.style.animationDuration = (Math.random() * 3 + 5) + 's';
            heart.style.fontSize = (Math.random() * 15 + 10) + 'px';
            heart.style.opacity = Math.random() * 0.5 + 0.3;
            heart.style.transform = `rotate(${Math.random() * 20 - 10}deg)`;
            document.getElementById('hearts').appendChild(heart);
            setTimeout(() => heart.remove(), 8000);
        }
        for (let i = 0; i < 20; i++) setTimeout(() => createHeart(), i * 200);
        setInterval(createHeart, 300);

        /* ========== 爱情计时器 ========== */
        function updateLoveTimer() {
            const startDate = new Date('2023-07-15T00:00:00');
            const now = new Date();
            const diff = now - startDate;
            const seconds = Math.floor(diff / 1000) % 60;
            const minutes = Math.floor(diff / (1000 * 60)) % 60;
            const hours = Math.floor(diff / (1000 * 60 * 60)) % 24;
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const years = Math.floor(days / 365);
            const remainingDays = days % 365;
            const months = Math.floor(remainingDays / 30);
            const finalDays = remainingDays % 30;

            document.getElementById('years').textContent = years;
            document.getElementById('months').textContent = months;
            document.getElementById('days').textContent = finalDays;
            document.getElementById('hours').textContent = hours.toString().padStart(2, '0');
            document.getElementById('minutes').textContent = minutes.toString().padStart(2, '0');
            document.getElementById('seconds').textContent = seconds.toString().padStart(2, '0');
        }
        updateLoveTimer();
        setInterval(updateLoveTimer, 1000);

        /* ========== 音乐播放器 ========== */
        const music = document.getElementById('music');
        const playBtn = document.getElementById('playBtn');
        const progressContainer = document.getElementById('progressContainer');
        const progress = document.getElementById('progress');
        const currentTimeEl = document.getElementById('currentTime');
        const volumeSlider = document.getElementById('volumeSlider');

        music.volume = 0.7;
        volumeSlider.value = 0.7;

        playBtn.addEventListener('click', () => {
            if (music.paused) {
                music.play();
                playBtn.innerHTML = '<i class="fas fa-pause"></i>';
            } else {
                music.pause();
                playBtn.innerHTML = '<i class="fas fa-play"></i>';
            }
        });
        music.addEventListener('timeupdate', () => {
            const percent = (music.currentTime / music.duration) * 100;
            progress.style.width = `${percent}%`;
            const m = Math.floor(music.currentTime / 60);
            const s = Math.floor(music.currentTime % 60);
            currentTimeEl.textContent = `${m}:${s < 10 ? '0' : ''}${s}`;
        });
        progressContainer.addEventListener('click', e => {
            const width = progressContainer.clientWidth;
            const clickX = e.offsetX;
            music.currentTime = (clickX / width) * music.duration;
        });
        volumeSlider.addEventListener('input', () => music.volume = volumeSlider.value);

        /* ========== 页面导航 ========== */
        const navItems = document.querySelectorAll('.nav-item');
        const pages = document.querySelectorAll('.page');

        navItems.forEach(item => {
            item.addEventListener('click', () => {
                const pageId = item.getAttribute('data-page');
                navItems.forEach(nav => nav.classList.remove('active'));
                item.classList.add('active');
                pages.forEach(page => page.classList.remove('active'));
                document.getElementById(`${pageId}-page`).classList.add('active');

                // 切换页面时重新拉取云端数据
                if (pageId === 'happy' || pageId === 'trash') loadEntries(pageId);
            });
        });

        /* ========== Supabase 配置 ========== */
        const supabaseUrl  = 'https://pqqfvciynvneypzbfqkk.supabase.co';
        const supabaseKey  = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhbmFzZSIsInJlZiI6InBxcWZ2Y2l5bnZuZXlwemJmcWtrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYwMjExOTgsImV4cCI6MjA3MTU5NzE5OH0.C04g1knnbLB3desOWhjlxWZ2O5srr7BmDE38P5Ugc3o';
        const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);

        /* ========== 云端存储功能 ========== */
        const saveEntry = async (type, text) => {
            try {
                const ipResponse = await fetch('https://api.ipify.org?format=json');
                const ipData = await ipResponse.json();
                const userIp = ipData.ip;

                const tableName = type === 'happy' ? 'happy' : 'unhappy';
                const { error } = await supabaseClient
                    .from(tableName)
                    .insert([{ text, user_ip: userIp }]);

                if (error) throw error;

                document.getElementById(`${type}-text`).value = '';
                loadEntries(type);
                alert('云端保存成功！');
            } catch (err) {
                console.error(err);
                // 失败 → 回退本地存储
                const entries = JSON.parse(localStorage.getItem(`${type}Entries`)) || [];
                entries.unshift({ text, date: new Date().toLocaleString('zh-CN') });
                localStorage.setItem(`${type}Entries`, JSON.stringify(entries));
                document.getElementById(`${type}-text`).value = '';
                loadEntries(type);
                alert('网络异常，已保存到本地');
            }
        };

        const loadEntries = async (type) => {
            const container = document.getElementById(`${type}-entries`);
            try {
                const tableName = type === 'happy' ? 'happy' : 'unhappy';
                const { data, error } = await supabaseClient
                    .from(tableName)
                    .select('*')
                    .order('created_at', { ascending: false });

                if (error) throw error;

                container.innerHTML = data.map(entry => `
                    <div class="entry-item ${type === 'unhappy' ? 'trash-item' : ''}">
                        <div class="entry-date">${new Date(entry.created_at).toLocaleString('zh-CN')}</div>
                        <div>${entry.text}</div>
                        <div class="entry-meta">来自 ${entry.user_ip}</div>
                    </div>`).join('');
            } catch {
                // 读取云端失败 → 本地
                const entries = JSON.parse(localStorage.getItem(`${type}Entries`)) || [];
                container.innerHTML = entries.map(e => `
                    <div class="entry-item ${type === 'unhappy' ? 'trash-item' : ''}">
                        <div class="entry-date">${e.date}</div>
                        <div>${e.text}</div>
                        <div class="entry-meta">（本地）</div>
                    </div>`).join('');
            }
        };

        document.getElementById('save-happy').addEventListener('click', () => {
            const val = document.getElementById('happy-text').value.trim();
            if (val) saveEntry('happy', val);
        });
        document.getElementById('save-trash').addEventListener('click', () => {
            const val = document.getElementById('unhappy-text').value.trim();
            if (val) saveEntry('unhappy', val);
        });

        /* ========== 烟花特效 ========== */
        const fireworksBtn = document.getElementById('fireworksBtn');
        const fireworksContainer = document.getElementById('fireworks-container');
        const qixiText = document.getElementById('qixi-text');
        const colors = ['#6e8efb', '#4a6cf7', '#a777e3', '#8a5ce6', '#ffd700', '#ffc107', '#ff8c00', '#ff6b00'];
        let fireworks = [], animationId = null;

        class Firework {
            constructor() {
                this.x = Math.random() * innerWidth;
                this.y = innerHeight + 20;
                this.targetY = 100 + Math.random() * (innerHeight / 2);
                this.speed = 2 + Math.random() * 3;
                this.size = 2 + Math.random() * 3;
                this.color = colors[Math.floor(Math.random() * colors.length)];
                this.hasExploded = false;
                this.particles = [];
                this.element = document.createElement('div');
                this.element.style.cssText = `position:absolute;width:${this.size}px;height:${this.size}px;border-radius:50%;background:${this.color};left:${this.x}px;top:${this.y}px;box-shadow:0 0 5px ${this.color},0 0 10px ${this.color}`;
                fireworksContainer.appendChild(this.element);
            }
            update() {
                if (!this.hasExploded) {
                    this.y -= this.speed;
                    this.element.style.top = this.y + 'px';
                    if (this.y <= this.targetY) this.explode();
                } else {
                    for (let i = this.particles.length - 1; i >= 0; i--) {
                        this.particles[i].update();
                        if (this.particles[i].alpha <= 0) {
                            this.particles[i].element.remove();
                            this.particles.splice(i, 1);
                        }
                    }
                    if (this.particles.length === 0) {
                        this.element.remove();
                        return true;
                    }
                }
                return false;
            }
            explode() {
                this.hasExploded = true;
                this.element.remove();
                for (let i = 0; i < 60 + Math.floor(Math.random() * 40); i++) {
                    this.particles.push(new Particle(this.x, this.y, this.color));
                }
            }
        }

        class Particle {
            constructor(x, y, color) {
                this.x = x; this.y = y; this.color = color;
                this.angle = Math.random() * Math.PI * 2;
                this.speed = 0.5 + Math.random() * 3;
                this.friction = 0.95;
                this.gravity = 0.2;
                this.alpha = 1;
                this.size = 1 + Math.random() * 2;
                this.vx = Math.cos(this.angle) * this.speed;
                this.vy = Math.sin(this.angle) * this.speed;
                this.element = document.createElement('div');
                this.element.style.cssText = `position:absolute;width:${this.size}px;height:${this.size}px;border-radius:50%;background:${this.color};left:${this.x}px;top:${this.y}px;box-shadow:0 0 5px ${this.color},0 0 10px ${this.color}`;
                fireworksContainer.appendChild(this.element);
            }
            update() {
                this.vx *= this.friction;
                this.vy *= this.friction;
                this.vy += this.gravity;
                this.x += this.vx;
                this.y += this.vy;
                this.alpha -= 0.01;
                this.element.style.left = this.x + 'px';
                this.element.style.top = this.y + 'px';
                this.element.style.opacity = this.alpha;
            }
        }

        function animateFireworks() {
            animationId = requestAnimationFrame(animateFireworks);
            if (Math.random() < 0.05 && fireworks.length < 15) fireworks.push(new Firework());
            for (let i = fireworks.length - 1; i >= 0; i--) {
                if (fireworks[i].update()) fireworks.splice(i, 1);
            }
        }

        fireworksBtn.addEventListener('click', () => {
            fireworksContainer.style.display = 'block';
            fireworksContainer.innerHTML = '';
            fireworks = [];
            qixiText.style.opacity = '1';
            qixiText.style.transform = 'translate(-50%, -50%) scale(1)';
            if (animationId) cancelAnimationFrame(animationId);
            animateFireworks();
            setTimeout(() => {
                cancelAnimationFrame(animationId);
                animationId = null;
                qixiText.style.opacity = '0';
                qixiText.style.transform = 'translate(-50%, -50%) scale(0)';
                setTimeout(() => fireworksContainer.style.display = 'none', 2000);
            }, 15000);
        });

        /* ========== 初始加载数据 ========== */
        loadEntries('happy');
        loadEntries('unhappy');
    </script>
</body>
</html>
